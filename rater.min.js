/*<nowiki>DF Wiki rater
Minified (http://marijnhaverbeke.nl/uglifyjs)
*/String.prototype.format=function(){for(s=this,i=0;arguments.length>i;i++)s=s.replace(RegExp("\\{"+i+"\\}","g"),arguments[i]);return s},String.prototype.capitalize=function(){return this.slice(0,1).toUpperCase()+this.slice(1)},addOnloadHook(function(){jQuery(function(a){function c(a){a&&a.preventDefault&&a.preventDefault.call&&a.preventDefault()}function e(a){return!(!a||!a.call)}var b={};if(!(mw&&"wgScript"in window))throw ReferenceError("`mw` or `wgScript` not found. This script must be run on a working wiki!");b.event=a({}),a.getScript(wgScript+"?title=User:Lethosor/raterwarn.js&action=raw"),b.page={name:wgPageName.replace(/_/g," "),ns:wgCanonicalNamespace||"Main",url:wgScript+"?title="+wgPageName,exists:!a("#left-navigation").find("li[class*=selected]").find("a[href*=redlink]").length,load_time:a("body").html().match(/<!--.*-->/g).slice(-1)[0].match(/\d+\.\d+/)[0]},b.is_valid_page=function(c){return b.page.exists?(c||(c=wgPageName),a("#norate").length?!1:"Masterwork DF2012 v0.31 40d 23a".split(" ").indexOf(b.page.ns)+1?!0:!1):!1},b.error_invalid_page=function(){"Special File Image Unused".indexOf(b.page.ns)+1||b.page.ns.toLowerCase().indexOf("talk")+1?(b.box.clear().append("<span class=\"error\">I'm afraid I can't let you do that, Urist.</span><p>This page isn't an article, and doesn't have some of the necessary properties to be rated. <a href=\"#rater-cancel\">Close this window</a></p>"),b.cancel_link.focus()):b.page.exists?a("#norate").length?b.box.clear().append('<span class="error">Invalid page</span>').append("<p>This page has been specified as unratable. You can <a href='#rater-force'>view this page's rating anyway</a> or <a href='#rater-cancel'>close this window</a>.</p>"):b.box.clear().append('<span class="error">Invalid page</span>').append("<p>This page is in an invalid namespace. You can <a href='#rater-force'>view this page's rating anyway</a> or <a href='#rater-cancel'>close this window</a>.</p>"):(b.box.clear().append('<p class="error">This page doesn\'t exist!</p><a href="#rater-cancel">Close this window</a>'),b.box.find("a:nth(1)").focus())},b.confirm=function(d){d=a.extend({title:"undefined",text:"undefined",ok:function(){},cancel:function(){},ok_text:"Ok",cancel_text:"Cancel"},d);var e=b.Dialog();e.show(),e.view.html('<p style="font-weight:bold">{0}</p><p>{1}</p>'.format(d.title,d.text)),e.bottom.append(a('<div id="buttons">').css({textAlign:"right"})),e.buttons=e.bottom.find("#buttons");var f=a("<a>").text(d.cancel_text).data("ok",0).appendTo(e.buttons),g=a("<a>").text(d.ok_text).data("ok",1).appendTo(e.buttons.append(" "));return e.select=function(b){c(b),e.hide(),a(this).data("ok")?d.ok():d.cancel()},g.add(f).attr({href:"#"}).on("click",e.select),e},b.confirm.close=function(){b.popup.hide()},a("li#ca-rater").hide(),b.overlay=a("<div>").css({width:"100%",height:"100%",top:0,left:0,position:"fixed","background-color":"rgba(128,128,128,0.5)","z-index":9999}).hide().appendTo("body");var f=a(window).height()/2,g=.8*a("#bodyContent").width();b.win=a("<div>").css({width:g+8,height:f+8,"font-size":"1.25em",top:"1.5em",right:0,position:"absolute","background-color":"#fbfbf9","z-index":1e4,overflow:"auto","border-radius":4,border:"1px solid #ccb","box-shadow":"0 0 6px rgba(128,128,128,.6)",overflow:"visible",padding:4}).hide().appendTo("#bodyContent"),b.win.filler=a("<div>").css({width:g+8,height:f+8,"font-size":"1.25em",top:0,left:0,position:"absolute","background-color":"#fbfbf9","z-index":10002,overflow:"hidden","border-radius":4}).appendTo(b.win),b.win.inner=a("<div>").css({display:"block",position:"relative",top:0,left:0,"border-radius":4,"z-index":10003,"background-color":"#fbfbf9",width:g-12,height:f,"overflow-y":"auto","overflow-x":"hidden",margin:6}).appendTo(b.win),b.win.arrow=a("<span>").css({display:"block",position:"absolute","background-color":"#fbfbf9",height:"1.5em",width:"1.5em",top:"-.75em",right:"1.5em","z-index":10001,"-webkit-transform":"rotate(45deg)",transform:"rotate(45deg)","box-shadow":"0 0 6px rgba(128,128,128,0.6)",border:"1px solid #ccb"}).prependTo(b.win),b.rating_exists=!0,a(".topicon").length||(b.rating_exists=!1,b.win.arrow.hide(),a("<div>").addClass("topicon").css({right:10}).appendTo("#bodyContent"),a(".topicon").append(a("<span>"))),b.hide_link=a("<a>").text("Hide").attr("href","#rater-hide").css({color:"#f60","float":"right",paddingRight:"0.5em"}).appendTo(b.win),b.cancel_link=a("<a>").text("Cancel").attr("href","#rater-cancel").css({color:"red","float":"right"}).appendTo(b.win),b.popup={},b.popup.overlay=a("<div>").css({width:"100%",height:"100%",top:0,left:0,position:"fixed","background-color":"rgba(128,128,128,0.5)","z-index":10001}).hide().appendTo("body"),b.popup.box=a("<div>").css({width:"40%",height:"60%",top:"20%",left:"30%",position:"fixed","background-color":"white","z-index":10002,padding:"1em",overflow:"auto","border-radius":4}).hide().appendTo("body"),b.popup.close_link=a("<a>").text("Close").attr("href","#rater-popup-hide").css({color:"red","float":"right"}).appendTo(b.popup.box),b.popup.show=b.popup_show=function(a){c(a),b.popup.box.stop(1,1).fadeIn(300),b.popup.overlay.stop(1,1).fadeIn(300)},b.popup.hide=b.popup_hide=function(a){c(a),b.popup.overlay.stop(1,1).fadeOut(300),b.popup.box.stop(1,1).fadeOut(300)},b.Dialog=function(b){var d={};return d.opts=a.extend({show_close_link:0},b),d.overlay=a("<div>").css({width:"100%",height:"100%",top:0,left:0,position:"fixed","background-color":"rgba(128,128,128,0.5)","z-index":11001}).hide().appendTo("body"),d.box=a("<div>").css({width:"40%",height:"20%",top:"30%",left:"30%",position:"fixed","background-color":"white","z-index":11002,padding:"1em",overflow:"auto","border-radius":4}).hide().appendTo("body"),d.view=a("<div>").appendTo(d.box),d.bottom=a("<div>").css({position:"absolute",bottom:"1em",right:"1em"}).appendTo(d.box),d.close_link=a("<a>").text("Close").attr("href","#rater-popup-hide").css({color:"red","float":"right"}).appendTo(d.box),d.opts.show_close_link||d.close_link.hide(),d.show=function(a){return c(a),d.box.stop(1,1).fadeIn(300),d.overlay.stop(1,1).fadeIn(300),d},d.hide=function(a){return c(a),d.overlay.stop(1,1).fadeOut(300),d.box.stop(1,1).fadeOut(300),d},d},a("body").on("click","a[href=#rater-popup-hide]",b.popup_hide),b.popup.clear=function(){b.popup.box.html("").append(b.popup.close_link)},b.popup.clear(),b.frame={list:{}},b.frame.current_frame=function(){return b.frame.list[b.frame.current]},b.frame.change=function(c){b.frame.current&&a(".rater-frame").hide().css({margin:"1em"}),c in b.frame.list||(b.frame.list[c]=a("<div>").addClass("rater-frame").css({margin:"1em",position:"relative"})),b.frame.list[c].appendTo(b.win.inner).show(),b.frame.current=c},b.frame.change("main"),b.box=b.frame.list.main,b.box.clear=function(){return b.box.html(""),b.box.append(b.cancel_link).append(b.hide_link).append(a("<h2>").text("Rating "+b.page.name)),b.event.trigger("box-clear"),b.box},b.box.clear(),b.cancel=function(a){c(a),b.show_link.removeClass("selected"),b.overlay.stop(1,1).fadeOut(300),b.win.stop(1,1).fadeOut(300),(b.is_valid_page()||b.rating_exists)&&b.show_link_topicon.show(500),b.active=!1},b.in_progress=!1,b.hide=function(d){c(d),b.win.fadeOut(300),b.resume_link=a("<a>").attr({href:"#rater-resume"}).text("Continue rating").appendTo(".topicon").css({padding:"0 0.5em"}),b.in_progress=!0},b.resume=function(a){c(a),b.in_progress&&(b.resume_link.hide(),b.win.fadeIn(300))},a("body").on("click","a[href=#rater-cancel]",b.cancel),a("body").on("click","a[href=#rater-hide]",b.hide),a("body").on("click","a[href=#rater-resume]",b.resume),b.show_link=a("<li>").append(a("<span>").append(a("<a href='#rater-invoke'>").text("Rate"))),a("#left-navigation #p-namespaces ul:nth(0)").append("<li><span><a></a></span></li>"),a("#left-navigation #p-namespaces ul:nth(0)").append(b.show_link),b.show_link_topicon=a("<a>").attr({href:"#rater-invoke",title:"Change this page's rating"}).text("Change").appendTo(".topicon").css({"padding-left":6}),b.rating_exists||b.show_link_topicon.hide(),b.active=!1,b.invoke=function(a,d){if(c(a),!b.active){if(b.win.stop(1,1).fadeIn(300),b.frame.change("main"),b.box.clear(),!b.is_valid_page(wgPageName)&&!d)return b.error_invalid_page();b.show_link_topicon.hide(500),b.show_link.addClass("selected"),b.box.append("<p>Performing automatic tests, please wait...</p>"),b.begin_tests(),b.active=!0}},a("body").on("click","a[href=#rater-invoke]",b.invoke),a("body").on("click","a[href=#rater-force]",function(a){b.invoke(a,1)}),b.nonstd={},b.nonstd.metadata={"rm-quality":{desc:"Remove the quality rating",process:function(a){return a.replace(/{{quality[^}]*?}}\n*/gi,"")},summary:'Removed quality rating (was "{0}")'},"mark-unrated":{desc:"Mark as unrated",process:function(a){return a.replace(/{{quality[^}]*?}}\n*/gi,"")+"{{quality|Unrated|~~~~~}}\n"},summary:'Changed quality rating from "{0}" to "Unrated"',needs_valid:!0}},b.frame.change("nonstd"),b.nonstd.view=b.frame.list.nonstd,b.frame.change("main"),b.nonstd.init=function(d){c(d),b.frame.change("nonstd");var e=b.nonstd.view;e.html("").append('<h2>Advanced options</h2><p id="p">No options available for this page.</p>'),e.append(b.nonstd.cancel_link);var f=b.nonstd.metadata,g=a("<ul>").appendTo(e);for(var h in f)if(!(h in{}||!b.is_valid_page()&&f[h].needs_valid)){e.find("p#p").hide();var i=a("<a>").text(f[h].desc).attr("href","#rater-nonstd-select").data("opt",h);g.append(a("<li>").append(i))}},b.nonstd.select=function(d){c(d),b.nonstd.opt=a(this).data("opt"),b.confirm({title:"Confirm",text:"Are you sure you want to perform this action?",ok_text:"Continue",ok:b.nonstd.process})},b.nonstd.process=function(){var a=b.nonstd.opt,c=b.nonstd.metadata,d=c[a].process(b.loader.results.raw);b.confirm({title:"Saving...",text:"Please wait",ok_text:"",cancel_text:""}),b.edit_page({text:d,minor:1,summary:c[a].summary.format(b.tests.current_rating)+" using the rating script"}).on("done",function(){window.location.reload()})},b.nonstd.cancel=function(a){c(a),b.frame.change("main")},b.nonstd.init_link=a("<a>").text("Advanced options").attr({href:"#rater-nonstd-init"}),b.nonstd.cancel_link=a("<a>").text("Back").attr({href:"#rater-nonstd-cancel"}).css({color:"red",position:"absolute",right:0,top:"1em"}),a("body").on("click","a[href=#rater-nonstd-init]",b.nonstd.init).on("click","a[href=#rater-nonstd-cancel]",b.nonstd.cancel).on("click","a[href=#rater-nonstd-select]",b.nonstd.select),b.event.bind("results-displayed",function(){b.nonstd.init_link.appendTo(b.box)}),b.metadata={},b.metadata.urls={raw:b.page.url+"&action=raw",render:b.page.url+"&action=render",whatlinkshere:wgScript+"?title=Special:WhatLinksHere/"+wgPageName+"&hideredirs=1&hidetrans=1",history:b.page.url+"&action=history&limit=100"},b.metadata.tests={redlinks:{name:"Redlinks",init:function(b){return(all_links=b.render.match(/<a .*<\/a>/g))?(total_redlinks=0,a.each(all_links,function(a,b){b.match(/href=.*redlink=1/)&&total_redlinks++}),total_redlinks):0},score:function(a){return-5*a+10}},links:{name:"Outbound links",init:function(b){return a(b.render).find('a[href*="'+wgScript+'"]').length},score:function(a){return 0==a?-25:a}},linkshere:{name:"Incoming links",init:function(b){var c=a(b.whatlinkshere).find("#mw-whatlinkshere-list").find("li"),d={length:c.length,list:[]};return c.each(function(b,c){d.list.push(a(c).find("a:nth(0)").text())}),d},str:function(a){return a.length},"int":function(a){return Number(a.length)},info:function(b,c){a("<h2>").text("Incoming links").appendTo(c);var d=a("<ul>").appendTo(c);for(i in b.list)i in[]||d.append('<li><a href="{1}/{0}" target="_blank">{0}</a></li>'.format(b.list[i],wgScript));c.append("<h4>Total: {0}</h4>".format(b.length))},score:function(a){var b=a.length;return 0==b?-35:2.5*b}},editors:{name:"Editor count",init:function(b){if(all_editors=b.history.match(/<li>.*<\/li>/g),!all_editors)return 0;var c={};a.each(all_editors,function(b,d){ed=a(d).find(".mw-userlink:nth(0)").text(),ed in c||(c[ed]=0),c[ed]++}),num=0;for(i in c)i in{}||num++;return c.total=num,c.total_edits=all_editors.length,c},str:function(a){return a.total},"int":function(a){return a.total},info:function(b,c){var d=a("<table>").css({width:"100%"}).append('<tr><th colspan="2">User</th><th>Edits</th></tr>').addClass("wikitable sortable").appendTo(c);for(i in b)i in{}||!i.indexOf("total")||d.append('<tr><td colspan="2"><a href="{2}/User:{0}" target="_blank">{0}</a>:</td><td>{1}</td></tr>'.format(i,b[i],wgScript));d.append('<tr style="font-weight:bold"><td>Total:</td><td>{0}</td><td>{1}</td></tr>'.format(b.total,b.total_edits))},score:function(a){var b=Math.max(1,Math.floor(a.total));return 1==b?0:2==b?6:3==b?14:20*b}},length:{name:"Article length",init:function(b){var c={full:b.raw.length,nospace:b.raw.replace(/\s/g,"").length,notemplate:b.raw.replace(/{{[^}]*?}}/g,"").length,plain:b.raw.replace(/\s/g,"").replace(/{{[^}]*?}}/g,"").length,html:b.render.length,text:a(b.render).text().length};return c.average=Math.round(.1*c.full+.2*c.notemplate+.2*c.plain+.1*c.html+.1*c.nospace+.3*c.text),c},"int":function(a){return a.average},str:function(a){return a.average+" (weighted)"},info:function(b,c){var d=a("<table>").css({width:"100%"}).append('<tr><th colspan="2">Article Length</th></tr>').addClass("wikitable").appendTo(c),e={html:"Generated HTML",text:"Displayed text",full:"Wikitext",nospace:"Wikitext without spaces",notemplate:"Wikitext without templates",plain:"Wikitext without spaces and templates"};for(i in b)i in e&&d.append("<tr><td>{0}</td><td>{1}</td></tr>".format(e[i],b[i]));d.append('<tr style="font-weight:bold;"><td>Weighted</td><td>{0}</td></tr>'.format(b.average))}},verify:{name:"{{Verify}} tags",init:function(a){var b=a.raw.match(/{{verify/g);return+(b&&b.length)},score:function(a){return 1>a?0:1==a?-10:-20*a}},categories:{name:"Categories",init:function(){var c={},d=a("body").find(".catlinks li");return c.total=d.length,c.list=[],d.each(function(b,d){c.list.push(a(d).text())}),c},"int":function(a){return a.total},info:function(b,c){a("<h2>").text("Categories").appendTo(c);var d=a("<ul>").appendTo(c);for(i in b.list)i in[]||d.append('<li><a href="{1}/Category:{0}" target="_blank">{0}</a></li>'.format(b.list[i],wgScript));c.append("<h4>Total: {0}</h4>".format(b.total))}},current_rating:{name:"Current rating",init:function(a){return m=a.raw.match(/{{quality[^}]*?}}/i),m&&m.length&&m[0].slice(2,-2).split("|")[1]||""},score:function(a){return[0,-15,0,10,20,40][b.rating_arr.indexOf(a)+1]}}},b.ratings={tattered:{id:1,color:{b:"#333",bg:"#ccc",c:"#333"},s:"x"},fine:{id:2,color:{b:"#db8",bg:"#ffe0cc",c:"#ca7a02"},s:"+"},superior:{id:3,color:{b:"#b8f",bg:"#e4ccff",c:"#80c"},s:"*"},exceptional:{id:4,color:{b:"#9df",bg:"#cce4ff",c:"#08c"},s:"\u2261"},masterwork:{id:5,color:{b:"#bd8",bg:"#e2fdce",c:"#72a329"},s:"\u263c"}},b.rating_arr=["tattered","fine","superior","exceptional","masterwork"],b.tests={};var h={};h.list={},h.results={},h.event=a({}),h.num_waiting=0,h.total_tests=0,h.key=Math.floor(1e8*Math.random()),h.add=function(b,c){h.list[b]={url:c},a.get(c,{rater:h.key},function(a){h.ready(b,a)}),h.num_waiting++,h.total_tests++},h.ready=function(a,b){h.list[a].result=h.results[a]=b,h.num_waiting--,h.event.trigger("ready",{left:h.num_waiting,total:h.total_tests,name:a,data:b}),0>=h.num_waiting&&setTimeout(h.all_complete,1)},h.all_complete=function(){h.event.trigger("done"),h.total_tests=0,h.event.off()},h.add_callback=function(a){h.event.bind("done",a)},h.reset=function(){h.key+=Math.floor(100*Math.random())+2},b.help={view:a("<div>").css({height:"100%"})},b.help.init=function(){a.get(wgScript+"/DF:Quality",function(c){c=a(c),b.help.data=[];for(var d=0;5>=d;d++)b.help.data[d]=c.find("h3:nth({0})".format(d)).nextUntil("h3"),b.help.data[d].splice(0,0,c.find("h3:nth({0})".format(d))[0]);b.help.update()})},b.help.update=function(a){if(b.help.data){if(!(a+1))try{a=b.ratings[b.select.current].id}catch(c){return}b.help.view.text("").append(b.help.data[a]),b.help.view.find(".editsection").hide()}},b.progress={},b.progress.view=a("<div>").css({width:"100%",padding:0,margin:0}),b.progress.bar=a("<div>").css({width:"100%","background-color":"#fff",border:"1px solid #ac7",padding:3,"border-radius":2,overflow:"hidden"}).appendTo(b.progress.view),b.progress.fill=a("<div>").css({"float":"left",padding:0,margin:0,"background-color":"#ce9","border-right":"1px solid #ac7",height:"100%",width:0,margin:-3,position:"relative",top:0,left:0,"border-radius":2}).appendTo(b.progress.bar).html("&nbsp;"),b.progress.update=function(a,c,d){var e=100*(a/Math.max(c,1));d=Number(d||0),d||(d=150),b.progress.fill.stop().animate({width:e+"%"},d)},b.progress.reset=function(){b.progress.update(0,1,-1)},b.begin_tests=function(){b.help.init(),b.progress.reset();for(i in b.metadata.urls)i in{}||h.add(i,b.metadata.urls[i]);h.event.bind("ready",function(a,c){b.progress.update(c.total-c.left,c.total)}),b.progress.view.appendTo(b.box),h.event.bind("done",b.process_tests),h.event.bind("done",b.display_test_results),h.event.bind("done",b.progress.reset)},b.score_bool=function(a,b,c){return isNaN(Number(c))&&(c=-b),Number(a?b:c)},b.score_int=function(a,b,c){return c||(c=0),a*b+c},b.tests={},b.process_tests=function(){var a=b.metadata.tests;for(i in a)i in{}||e(a[i].init)&&(b.tests[i]=a[i].init(h.results))},b.display_test_results=function(){b.frame.change("main");var c=b.metadata.tests;b.box.clear(),data=b.tests,b.score=0;for(var f in data)name=c[f].name,str=e(c[f].str)?c[f].str(data[f]):e(c[f].int)?c[f].int(data[f]):data[f],e(c[f].info)&&(str=a('<a href="#">'+str+"</a>").data({f:c[f].info,d:data[f]}).click(function(c){d=a(this).data(),b.popup.clear(),b.popup_show(c),d.f(d.d,b.popup.box.append(a("<div>")))}).css({color:"#1655ad"})),b.box.append(a("<p>"+name+": </p>").append(str)),e(c[f].score)&&(b.score+=Number(c[f].score(data[f])));b.box.append(a("<p>").text("Score: "+b.score)),a("<a>").attr({href:"#rater-override"}).html("Select rating &rarr;").appendTo(b.box).css({position:"absolute",top:"1em",right:"0"}),b.event.trigger("results-displayed")},b.select={},b.select.view=a("<div>").css({padding:".2em"}),b.select.init=function(a){c(a),b.frame.change("rating-desc"),b.select.frame=b.frame.current_frame(),b.select.current=b.tests.current_rating.toLowerCase()||"tattered",b.select.view.appendTo(b.select.frame),b.select.draw()},a("body").on("click","a[href=#rater-override]",b.select.init),b.select.draw=function(){a(".topicon > span").hide();var c,d,e,f=b.select.view,g=a("<span>").appendTo(".topicon");f.html(""),g.html(""),a("<span>").text("Select rating: ").appendTo(g),list=a("<span>").css({"font-size":".8em"}).appendTo(g);for(i in b.ratings)i in{}||(c=b.ratings[i],e=a("<span>").appendTo(list).data("rating",i).attr({tabindex:0}).css({cursor:"pointer"}),e.append(a("<span>").text(c.s+i.toUpperCase()+c.s).css({"text-decoration":"none",color:c.color.c})),i==b.select.current&&(d=b.ratings[i],e.find("span").css({"border-color":c.color.b,"background-color":c.color.bg,"border-width":1,"border-style":"solid","border-radius":2,padding:".2em"})),e.on("click focus",b.select.click),list.append(" "));b.is_valid_page()&&(b.select.submit_link=a("<a>").attr({href:"#rater-select-submit"}).text("Submit").appendTo(g),g.append(" ")),b.select.reset_link=a("<a>").attr({href:"#rater-select-reset"}).text("Reset").appendTo(g),g.append(" "),b.select.cancel_link=a("<a>").attr({href:"#rater-select-cancel"}).text("Back").appendTo(g).css({color:"red"}),b.select.cancel_link.clone().appendTo(f),b.help.view.appendTo(f),b.help.update(d&&d.id||0)},b.select.click=function(d){"click"==d.type&&c(d),b.select.current=a(this).data("rating"),b.select.draw()},b.select.reset=function(a){c(a),b.select.init()},b.select.cancel=function(d){c(d),b.select.reset(),a(".topicon > span").hide().filter(":nth(0)").show(),b.frame.change("main")},a("body").on("click","a[href=#rater-select-reset]",b.select.reset),a("body").on("click","a[href=#rater-select-cancel]",b.select.cancel),a("body").on("click","a[href=#rater-select-submit]",function(a){c(a),b.submit_rating()}),b.submit_rating=function(){function e(a){d.append(a)}function o(){b.popup.hide(),b.frame.change("rating-desc"),b.overlay.fadeOut(400)}b.overlay.fadeIn(400),b.frame.change("submit-progress");var c=b.frame.current_frame();c.html(""),b.progress.reset(),b.progress.view.appendTo(c);var d=a("<div>").css({"white-space":"pre"}).appendTo(c),f=b.select.current;if(!(f in{})&&f in b.ratings){var g=b.select.current.capitalize(),j=b.tests.current_rating.capitalize();if(b.loader.results.raw){e("Getting token... ");var k=mw.user.tokens.values.editToken;b.progress.update(1,4),e("Ok ({0})\nReplacing quality template... ".format(k.slice(0,8))),console.log(k);var l=b.loader.results.raw.replace(/{{quality[^}]*?}}\n*/gi,"");l="{{Quality|"+g+"|~~~~~}}\n"+l,e("Ok\nEditing page... ");var m=""!=j?'Changed quality rating from "{0}" to "{1}" using the rating script'.format(j,g):'Added quality rating "{0}" using the rating script'.format(g);g==j&&(m='Updated quality rating timestamp ("{0}") using the rating script'.format(g)),b.progress.update(2,4);var n=function(){b.overlay.fadeIn(400),b.update_page=function(){b.progress.update(3,4),e("Finished!\nUpdating..."),a.get(wgScriptPath+"/api.php",{action:"parse",text:"{{Quality|"+g+"|~~~~~}}",format:"json",title:wgPageName},function(c){b.progress.update(4,4),a(".topicon > *").hide().parent().prepend(a(c.parse.text["*"]).filter(":nth(0)").contents()),a(".catlinks ul:nth(0) li a:contains(Quality Articles)").hide();var d=c.parse.categories;for(i=0;d.length>i;i++)a("<a>").attr({href:wgScript+"/Category:"+d[i]["*"]}).text(d[i]["*"].replace(/_/g," ")).appendTo(a("<li>").appendTo(".catlinks ul"));a(".catlinks li a:hidden").remove(),a(".catlinks li:empty").remove(),b.progress.update(5,4),b.cancel(),jsMsg("Rated article <b>"+g+"</b>");var e=document.title;document.title="Rated article "+g,setTimeout(function(){document.title=e},2500),h.reset()})},b.edit_page({minor:1,text:l,summary:m}).on("done",b.update_page)};g==j?b.confirm({title:"Confirm submission",text:"The rating you selected is the same as the current rating. Continuing will only update the timestamp. Do you want to continue?",ok_text:"Only update timestamp",ok:n,cancel:o}):n()}}},b.edit_page=function(c){if(!("text"in c))return!1;c=a.extend({summary:"",token:mw.user.tokens.values.editToken,title:b.page.name,minor:0},c);var d=a({});return a.post(wgScriptPath+"/api.php",{action:"edit",title:c.title,text:c.text,token:c.token,minor:c.minor,summary:c.summary},function(){d.trigger("done")}),d},window.location.hash.length&&(b.auto_link=a("<a>").attr("href",window.location.hash).appendTo("body"),setTimeout(function(){b.auto_link.click()},100)),b.qs_raw=window.location.search.slice(1),b.qs_list=b.qs_raw.split("&"),b.qs={};for(var i=0;b.qs_list.length>i;i++){var j=b.qs_list[i].split("=");b.qs[j[0]]=j[1]}return b.loader=h,window.rater=b,b})});
//</nowiki>
